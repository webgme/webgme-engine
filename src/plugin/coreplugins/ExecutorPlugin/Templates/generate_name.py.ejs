import os
import json
import sys
import logging
import time

## Setup a logger
# Create logger with 'spam_application'.
logger = logging.getLogger()
logger.setLevel(logging.DEBUG)

# Create file handler which logs even debug messages.
if not os.path.isdir('log'):
    os.mkdir('log')

fh = logging.FileHandler(os.path.join('log', 'execute.log'))
fh.setLevel(logging.DEBUG)

# Create console handler with a higher log level.
ch = logging.StreamHandler(sys.stdout)
ch.setLevel(logging.INFO)

# Create formatter and add it to the handlers.
formatter = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')
fh.setFormatter(formatter)
ch.setFormatter(formatter)

# Add the handlers to the logger.
logger.addHandler(fh)
logger.addHandler(ch)

if __name__ == '__main__':
    logger.info('generate_name script started.')
    if len(sys.argv) < 2:
        logger.error('Provide a path to the active node!')
        sys.exit(1)
    active_node_path = sys.argv[1]
    logger.info('active node path : {0}'.format(active_node_path))
    with open('new_name.json', 'w') as f_out:
        json.dump({active_node_path: 'ThisIsANewName'}, f_out)
    logger.info('created new_name.json')
    cnt = 0
    logger.info('output_{0}'.format(cnt))
    cnt += 1
    logger.info('output_{0}'.format(cnt))
    cnt += 1
    logger.info('output_{0}'.format(cnt))
    cnt += 1
    logger.info('output_{0}'.format(cnt))
    cnt += 1
    logger.info('output_{0}'.format(cnt))
    cnt += 1

    logger.info('1 Going to sleep for {0} seconds.. zzZzZZ'.format(<%=sleepTime%>))
    time.sleep(<%=sleepTime%>)
    logger.info('1 Good Morning!')

    logger.info('output_{0}'.format(cnt))
    cnt += 1
    logger.info('output_{0}'.format(cnt))
    cnt += 1
    logger.info('output_{0}'.format(cnt))
    cnt += 1
    logger.info('output_{0}'.format(cnt))
    cnt += 1
    logger.info('output_{0}'.format(cnt))
    cnt += 1

    logger.info('2 Going to sleep again for {0} seconds.. zzZzZZ'.format(<%=sleepTime%>))
    time.sleep(<%=sleepTime%>)
    logger.info('2 Good Morning!')

    logger.info('output_{0}'.format(cnt))
    cnt += 1
    logger.info('output_{0}'.format(cnt))
    cnt += 1
    logger.info('output_{0}'.format(cnt))
    cnt += 1
    logger.info('output_{0}'.format(cnt))
    cnt += 1
    logger.info('output_{0}'.format(cnt))

    logger.info('Will exit with code {0}'.format(<%=exitCode%>))
    sys.exit(<%=exitCode%>)